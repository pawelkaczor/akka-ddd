<html><head><title>Akka-DDD: Aggregate Root - Logical Model</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="PaweÅ‚ Kaczor" /><meta name="description" content="Scala CQRS/ES framework" /><meta name="og:image" content="/akka-ddd/img/poster.png" /><meta name="og:title" content="Akka-DDD: Aggregate Root - Logical Model" /><meta name="og:site_name" content="Akka-DDD" /><meta name="og:url" content="http://github.com/pawelkaczor/akka-ddd" /><meta name="og:type" content="website" /><meta name="og:description" content="Scala CQRS/ES framework" /><link rel="icon" type="image/png" href="/akka-ddd/img/favicon.png" /><meta name="twitter:title" content="Akka-DDD: Aggregate Root - Logical Model" /><meta name="twitter:image" content="http://github.com/pawelkaczor/akka-dddimg/poster.png" /><meta name="twitter:description" content="Scala CQRS/ES framework" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/akka-ddd/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/akka-ddd/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/akka-ddd/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/akka-ddd/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/akka-ddd/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/akka-ddd/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/akka-ddd/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/akka-ddd/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/akka-ddd/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/akka-ddd/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/akka-ddd/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/akka-ddd/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/akka-ddd/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/akka-ddd/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/akka-ddd/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/akka-ddd/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/akka-ddd/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/akka-ddd/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/akka-ddd/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/akka-ddd/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/akka-ddd/highlight/styles/github.css" /><link rel="stylesheet" href="/akka-ddd/css/style.css" /><link rel="stylesheet" href="/akka-ddd/css/palette.css" /><link rel="stylesheet" href="/akka-ddd/css/codemirror.css" /><link rel="stylesheet" href="/akka-ddd/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/akka-ddd/" class="brand"><div class="brand-wrapper"><span>Akka-DDD</span></div></a></li> <li><a href="/akka-ddd/index.html" class="">Introduction</a></li> <li><a href="/akka-ddd/docs/getting-started.html" class="">Getting Started</a></li> <li><a href="/akka-ddd/docs/aggregate-root.html" class="">Aggregate Root</a> <ul class="sub_section"> <li><a href="/akka-ddd/docs/aggregate-root/logical-model" class="">Logical Model</a></li> <li><a href="/akka-ddd/docs/aggregate-root/implementation" class="">Implementation</a></li> <li><a href="/akka-ddd/docs/aggregate-root/actor" class="">Actor</a></li> <li><a href="/akka-ddd/docs/aggregate-root/configuration" class="">Configuration</a></li> <li><a href="/akka-ddd/docs/aggregate-root/testing" class="">Testing</a></li></ul></li> <li><a href="/akka-ddd/docs/process-manager.html" class="">Process Manager</a> <ul class="sub_section"> <li><a href="/akka-ddd/docs/process-manager/logical-model" class="">Logical Model</a></li> <li><a href="/akka-ddd/docs/process-manager/implementation" class="">Implementation</a></li> <li><a href="/akka-ddd/docs/process-manager/actor" class="">Actor</a></li> <li><a href="/akka-ddd/docs/process-manager/configuration" class="">Configuration</a></li> <li><a href="/akka-ddd/docs/process-manager/testing" class="">Testing</a></li></ul></li> <li><a href="/akka-ddd/docs/projections.html" class="">Projections</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/pawelkaczor/akka-ddd"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/pawelkaczor/akka-ddd"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Akka-DDD Scala CQRS/ES framework');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Akka-DDD Scala CQRS/ES framework');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="pawelkaczor" data-github-repo="akka-ddd"><div class="content-wrapper"><section><h2 id="aggregate-root---logical-model">Aggregate Root - Logical Model</h2>

<p>The logical model of the Aggregate Root is purely behavioral. 
The Aggregate Root exposes a set of <strong>business operations</strong> (commands) related to a <strong>business entity/case</strong>. 
When a <strong>command</strong> is received, it is <strong>validated</strong> against the <strong>current state</strong> of the AR and either it is <strong>accepted</strong> or <strong>rejected</strong>. If a command is accepted, an <strong>event</strong> (or a sequence of events) is stored in the AR journal and the state of the AR is updated. The state of the AR is its internal property, that can never be accessed directly from the outside of the AR. Thus, the structure of the AR (the structure of the AR state) is not a property of the AR logical model.</p>

<p>The <strong>logical model</strong> of the AR can only be defined as a <strong>set of behavior scenarios / specifications</strong>, each expressed in the following form:</p>

<h3 id="aggregate-root---behavior-specification">Aggregate Root - Behavior Specification</h3>

<table style="margin-left:40px; font-size: 18px">
<tr>
<td style="border: none">
<h4 style="margin-top:10px">Given</h4>
&nbsp; &nbsp; &nbsp; &nbsp; a sequence of commands CG-1...CG-n accepted
<h4>When</h4>

&nbsp; &nbsp; &nbsp; &nbsp; a command CR received   

<h4>Then</h4>

&nbsp; &nbsp; &nbsp; &nbsp; an event E (or a sequence of events E-1...E-n) stored in the AR journal

</td></tr>

<tr><td style="border: none">&nbsp; &nbsp; &nbsp; &nbsp; <b>or</b></td></tr>
<tr><td style="border: none">&nbsp; &nbsp; &nbsp; &nbsp; the command CR rejected due to a reason R</td></tr>
<tr><td style="border: none">&nbsp;</td></tr>
</table>

<p>Not surprisingly, the AR logical model defined as a set of AR behavior specifications is a perfectly valid, complete specification of the unit test that the AR implementation should be accompanied by.</p>

<p>Following, is a single behavior specification for the <a href="">Reservation</a> AR, implemented as a unit test using Given-When-Then test fixture provided by the Akka-DDD:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="s">"Reservation office"</span> <span class="n">should</span> <span class="o">{</span>
    <span class="s">"confirm reservation"</span> <span class="n">in</span> <span class="o">{</span>
      <span class="n">given</span><span class="o">(</span>
        <span class="nc">CreateReservation</span><span class="o">(</span><span class="n">reservationId</span><span class="o">,</span> <span class="s">"client1"</span><span class="o">),</span>
        <span class="nc">ReserveProduct</span><span class="o">(</span><span class="n">reservationId</span><span class="o">,</span> <span class="n">product</span><span class="o">,</span> <span class="n">quantity</span> <span class="k">=</span> <span class="mi">1</span><span class="o">)</span>
      <span class="o">)</span>
      <span class="o">.</span><span class="n">when</span><span class="o">(</span>
        <span class="nc">ConfirmReservation</span><span class="o">(</span><span class="n">reservationId</span><span class="o">)</span>
      <span class="o">)</span>
      <span class="o">.</span><span class="n">expectEvent</span> <span class="o">{</span>
        <span class="nc">ReservationConfirmed</span><span class="o">(</span><span class="n">reservationId</span><span class="o">,</span> <span class="s">"client1"</span><span class="o">,</span> <span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>See: <a href="testing">Testing Aggregate Root</a></p>

<h3 id="aggregate-root-id">Aggregate Root ID</h3>

<p>Aggregate Root ID is the identifier of the associated business entity/case. All commands are expected to inherit from the <a href="">Command</a> trait to be able to expose the Aggregate Root ID (by implementing the [aggregateId() method).</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/akka-ddd/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'pawelkaczor/akka-ddd'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/akka-ddd/js/main.js"></script></body></html>