<html><head><title>Akka-DDD: Aggregate Root - Configuration</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="PaweÅ‚ Kaczor" /><meta name="description" content="Akka-based framework following DDD/CQRS/ES principles" /><meta name="og:image" content="/akka-ddd/img/poster.png" /><meta name="og:title" content="Akka-DDD: Aggregate Root - Configuration" /><meta name="og:site_name" content="Akka-DDD" /><meta name="og:url" content="http://github.com/pawelkaczor/akka-ddd" /><meta name="og:type" content="website" /><meta name="og:description" content="Akka-based framework following DDD/CQRS/ES principles" /><link rel="icon" type="image/png" href="/akka-ddd/img/favicon.png" /><meta name="twitter:title" content="Akka-DDD: Aggregate Root - Configuration" /><meta name="twitter:image" content="http://github.com/pawelkaczor/akka-dddimg/poster.png" /><meta name="twitter:description" content="Akka-based framework following DDD/CQRS/ES principles" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/akka-ddd/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/akka-ddd/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/akka-ddd/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/akka-ddd/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/akka-ddd/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/akka-ddd/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/akka-ddd/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/akka-ddd/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/akka-ddd/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/akka-ddd/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/akka-ddd/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/akka-ddd/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/akka-ddd/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/akka-ddd/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/akka-ddd/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/akka-ddd/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/akka-ddd/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/akka-ddd/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/akka-ddd/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/akka-ddd/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/akka-ddd/highlight/styles/github.css" /><link rel="stylesheet" href="/akka-ddd/css/style.css" /><link rel="stylesheet" href="/akka-ddd/css/palette.css" /><link rel="stylesheet" href="/akka-ddd/css/codemirror.css" /><link rel="stylesheet" href="/akka-ddd/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/akka-ddd/" class="brand"><div class="brand-wrapper"><span>Akka-DDD</span></div></a></li> <li><a href="/akka-ddd/docs/getting-started.html" class="">Getting Started</a></li> <li><a href="/akka-ddd/docs/aggregate-root.html" class="">Aggregate Root</a> <ul class="sub_section"> <li><a href="/akka-ddd/docs/aggregate-root/logical-model" class="">Logical Model</a></li> <li><a href="/akka-ddd/docs/aggregate-root/implementation" class="">Implementation</a></li> <li><a href="/akka-ddd/docs/aggregate-root/actor" class="">Actor</a></li> <li><a href="/akka-ddd/docs/aggregate-root/configuration" class="">Configuration</a></li> <li><a href="/akka-ddd/docs/aggregate-root/testing" class="">Testing</a></li></ul></li> <li><a href="/akka-ddd/docs/process-manager.html" class="">Process Manager</a> <ul class="sub_section"> <li><a href="/akka-ddd/docs/process-manager/intro" class="">Introduction</a></li> <li><a href="/akka-ddd/docs/process-manager/impl" class="">Implementation</a></li> <li><a href="/akka-ddd/docs/process-manager/saga-pattern" class="">Saga Pattern</a></li> <li><a href="/akka-ddd/docs/process-manager/configuration" class="">Configuration</a></li> <li><a href="/akka-ddd/docs/process-manager/testing" class="">Testing</a></li></ul></li> <li><a href="/akka-ddd/docs/projections.html" class="">Projections</a></li> <li><a href="/akka-ddd/docs/reliable-messaging.html" class="">Reliable messaging</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/pawelkaczor/akka-ddd"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/pawelkaczor/akka-ddd"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Akka-DDD Akka-based framework following DDD/CQRS/ES principles');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Akka-DDD Akka-based framework following DDD/CQRS/ES principles');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="pawelkaczor" data-github-repo="akka-ddd"><div class="content-wrapper"><section><h2 id="aggregate-root---configuration">Aggregate Root - Configuration</h2>

<p>When creating a class of the Aggregate Root Actor or the root trait of the Aggregate Root behavior, it is necessary to declare
the Aggregate Root configuration interface. If you do not intend to extend the default Aggregate Root configuration interface, just use the <a href="">Config</a> trait as show in the examples below:</p>

<p>Root trait of the Reservation AR behavior:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Reservation</span> <span class="k">extends</span> <span class="nc">Behavior</span><span class="o">[</span><span class="kt">Event</span>, <span class="kt">Reservation</span>, <span class="kt">Config</span><span class="o">]</span> 
</code></pre>
</div>

<p>Reservation AR Actor:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ReservationAggregateRoot</span><span class="o">(</span><span class="k">val</span> <span class="n">config</span><span class="k">:</span> <span class="kt">Config</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AggregateRoot</span><span class="o">[</span><span class="kt">Event</span>, <span class="kt">Reservation</span>, <span class="kt">ReservationAggregateRoot</span><span class="o">]</span>
  <span class="k">with</span> <span class="nc">ConfigClass</span><span class="o">[</span><span class="kt">Config</span><span class="o">]</span>
</code></pre>
</div>

<p>The default configuration interface exposes two properties: <code class="highlighter-rouge">PassivationConfig</code> and <code class="highlighter-rouge">RespondingPolicy</code>.</p>

<h3 id="passivation-configuration">Passivation Configuration</h3>

<p>The inactivity timeout, defined by the <a href="">Graceful Passivation</a> protocol, can be configured independently for each Aggregate Root Actor class. It is the responsibility of the Office to create <a href="">PassivationConfig</a> object with default value for inactivity timeout. The value can be adjusted by the <a href="">Aggregate Root Actor Factory</a>.</p>

<h3 id="responding-policy">Responding Policy</h3>

<p><a href="">RespondingPolicy</a> trait defines the <code class="highlighter-rouge">successMapper</code> function. The function is responsible for creating a response message that the command sender receives in case the command is accepted.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">RespondingPolicy</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">SuccessMapper</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Seq</span><span class="o">[</span><span class="kt">OfficeEventMessage</span><span class="o">])</span> <span class="k">=&gt;</span> <span class="nc">Any</span>
  <span class="k">def</span> <span class="n">successMapper</span><span class="k">:</span> <span class="kt">SuccessMapper</span>
<span class="o">}</span>
</code></pre>
</div>

<p>You can define a custom Responding Policy by providing your own implementation of the <code class="highlighter-rouge">RespondingPolicy</code> trait or you can use one of the built-in policies:</p>

<ul>
  <li><a href="">SparseReply</a> - a generic message is returned</li>
  <li><a href="">ReplyWithEvents</a> - the sequence of <a href="">OfficeEventMessage</a> is returned</li>
</ul>

<p>The default configuration class (<code class="highlighter-rouge">DefaultConfig</code>) defines the <code class="highlighter-rouge">replyWithEvents</code> flag, that you should set to false if the <code class="highlighter-rouge">SparseReply</code> responding policy should be used instead of the default one (<code class="highlighter-rouge">ReplyWithEvents</code>).</p>

<p>See also: <a href="">Aggregate Root Actor Factory</a></p>

<h3 id="logging">Logging</h3>

<p>To enable extensive logging of the Aggregate Root Actor, use <a href="">AggregateRootLogger</a> trait. It should be mixed into the the Aggregate Root Actor class.</p>

<p>Received commands, executed reactions, and the current state will be included in the log, as shown in the example below:</p>

<p>Lottery AR test scenario:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="s">"Lottery should"</span> <span class="n">should</span> <span class="o">{</span>
    <span class="s">"run"</span> <span class="n">in</span> <span class="o">{</span>
      <span class="n">given</span> <span class="o">{</span>
        <span class="n">a_list_of</span> <span class="o">[</span><span class="kt">CreateLottery</span>, <span class="kt">AddParticipant</span>, <span class="kt">AddParticipant</span><span class="o">]</span>
      <span class="o">}</span>
      <span class="o">.</span><span class="n">when</span> <span class="o">{</span>
        <span class="n">a</span> <span class="o">[</span><span class="kt">Run</span><span class="o">]</span>
      <span class="o">}</span>
      <span class="o">.</span><span class="n">expectEventMatching</span> <span class="o">{</span>
        <span class="k">case</span> <span class="n">e</span><span class="k">:</span> <span class="kt">WinnerSelected</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Generated log messages:</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>13:17:23.775UTC DEBUG akka://Tests/user/LotteryAggregateRoot_26aaff - Actor created b02772909
13:17:24.090UTC DEBUG LotteryAggregateRoot-b02772909 - Command received: CreateLottery(b02772909)
13:17:24.150UTC DEBUG LotteryAggregateRoot-b02772909 - Command accepted. LotteryCreated(b02772909)
13:17:24.176UTC DEBUG LotteryAggregateRoot-b02772909 - State: EmptyLottery
13:17:24.191UTC DEBUG LotteryAggregateRoot-b02772909 - Command received: AddParticipant(b02772909,Paul)
13:17:24.194UTC DEBUG LotteryAggregateRoot-b02772909 - Command accepted. ParticipantAdded(Paul,b02772909)
13:17:24.198UTC DEBUG LotteryAggregateRoot-b02772909 - State: NonEmptyLottery(List(Paul))
13:17:24.199UTC DEBUG LotteryAggregateRoot-b02772909 - Command received: AddParticipant(b02772909,John)
13:17:24.203UTC DEBUG LotteryAggregateRoot-b02772909 - Command accepted. ParticipantAdded(John,b02772909)
13:17:24.205UTC DEBUG LotteryAggregateRoot-b02772909 - State: NonEmptyLottery(List(John, Paul))
13:17:24.255UTC DEBUG akka://Tests/user/LotteryAggregateRoot_4402a5 - Actor created b02772909
13:17:24.264UTC DEBUG LotteryAggregateRoot-b02772909 - Command received: Run(b02772909)
13:17:24.267UTC DEBUG LotteryAggregateRoot-b02772909 - Command accepted. WinnerSelected(John,2017-07-16T15:17:24.265+02:00,b02772909)
13:17:24.269UTC DEBUG LotteryAggregateRoot-b02772909 - State: FinishedLottery(John,b02772909)
</code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/akka-ddd/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'pawelkaczor/akka-ddd'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/akka-ddd/js/main.js"></script></body></html>